{"version":3,"sources":["file:///D:/Desktop/cocosProject/SlotBar/assets/slotBar/scripts/views/SlotBar/ReelView.ts"],"names":["_decorator","Button","Component","RichText","soltEventTypes","ReelSlot","EventBus","ccclass","property","ReelView","spinCompletedCount","onEnable","startButton","node","on","onClickSpin","slotBarEventBus","InitReel","onInitReel","FetchResult","onFetchResult","UpdateCoinText","updateCoinText","onDisable","off","symbolDataList","i","reelViews","length","initReel","data","active","reelView","getComponent","spinRounds","results","result","map","item","String","console","log","onOneSpinEnd","showFinalResult","balance","emit","AllReelsFinished","spinToSymbol","resultRichText","string","SpinStart","join","coinNum","coinRichText"],"mappings":"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","sourcesContent":["import {_decorator, Button, Component, RichText} from 'cc';\r\nimport {soltEventTypes} from '../../eventSystem/EventTypes';\r\nimport {SymbolData} from '../../types/SymbolData';\r\nimport {ReelSlot} from \"db://assets/slotBar/scripts/views/SlotBar/ReelSlot\";\r\nimport EventBus from \"db://assets/slotBar/scripts/eventSystem/EventCenter\";\r\n\r\nconst {ccclass, property} = _decorator;\r\n\r\n@ccclass('ReelView')\r\nexport class ReelView extends Component {\r\n    @property(ReelSlot)\r\n    reelViews: ReelSlot[] = [];\r\n\r\n    @property(Button)\r\n    startButton: Button = null;\r\n\r\n    @property(RichText)\r\n    resultRichText: RichText = null;\r\n\r\n    @property(RichText)\r\n    coinRichText: RichText = null;\r\n\r\n    private spinCompletedCount = 0; // Áî®‰æÜË®òÈåÑÂÆåÊàêÂπæÂÄãÊªæËº™\r\n\r\n    onEnable() {\r\n        this.startButton.node.on('click', this.onClickSpin, this);\r\n        EventBus.slotBarEventBus.on(soltEventTypes.InitReel, this.onInitReel, this);\r\n        EventBus.slotBarEventBus.on(soltEventTypes.FetchResult, this.onFetchResult, this);\r\n        EventBus.slotBarEventBus.on(soltEventTypes.UpdateCoinText, this.updateCoinText, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.startButton.node.off('click', this.onClickSpin, this);\r\n        EventBus.slotBarEventBus.off(soltEventTypes.InitReel, this.onInitReel, this);\r\n        EventBus.slotBarEventBus.off(soltEventTypes.FetchResult, this.onFetchResult, this);\r\n        EventBus.slotBarEventBus.off(soltEventTypes.UpdateCoinText, this.updateCoinText, this);\r\n    }\r\n\r\n    private onInitReel(symbolDataList: SymbolData[]) {\r\n        for (let i = 0; i < this.reelViews.length; i++) {\r\n            this.reelViews[i].initReel(symbolDataList);\r\n        }\r\n    }\r\n\r\n    private onFetchResult(data: any) {\r\n        this.startButton.node.active = false; // ÈáçÊñ∞ÂïüÁî®ÈñãÂßãÊåâÈàï\r\n        for (let i = 0; i < this.reelViews.length; i++) {\r\n            const reelView = this.reelViews[i].getComponent(ReelSlot);\r\n            if (reelView) {\r\n                const spinRounds = 3 + i; // Á¨¨‰∏ÄËº™ËΩâ 3 ÂúàÔºåÁ¨¨‰∫åËº™ËΩâ 4 ÂúàÔºåÁ¨¨‰∏âËº™ËΩâ 5 Âúà\r\n                const results: string[] = (data.result as any[]).map(item => String(item));\r\n                console.log(`Ê®°Êì¨ÁµêÊûú: ${results[i]}`);\r\n                const onOneSpinEnd = () => {\r\n                    this.spinCompletedCount++;\r\n                    if (this.spinCompletedCount === this.reelViews.length) {\r\n                        this.showFinalResult(results);\r\n                        this.updateCoinText(data.balance);\r\n                        this.startButton.node.active = true; // ÈáçÊñ∞ÂïüÁî®ÈñãÂßãÊåâÈàï\r\n                        EventBus.slotBarEventBus.emit(soltEventTypes.AllReelsFinished);\r\n                    }\r\n                };\r\n\r\n                reelView?.spinToSymbol(results[i], spinRounds, 0.5, onOneSpinEnd);\r\n            }\r\n        }\r\n    }\r\n\r\n    onClickSpin() {\r\n        this.spinCompletedCount = 0; // ÈáçÁΩÆÂÆåÊàêË®àÊï∏\r\n        this.resultRichText.string = 'üé∞ ÊóãËΩâ‰∏≠...';\r\n        EventBus.slotBarEventBus.emit(soltEventTypes.SpinStart);\r\n    }\r\n\r\n    showFinalResult(results: string[]) {\r\n        this.resultRichText.string = `üéâ ÁµêÊûúÔºö${results.join(' - ')}`;\r\n    }\r\n\r\n    updateCoinText(coinNum: any) {\r\n        this.coinRichText.string = `üí∞ ÈáëÂπ£Ôºö${coinNum}`;\r\n    }\r\n}\r\n\r\n\r\n"]}