{"version":3,"sources":["file:///D:/Desktop/cocosProject/SlotBar/assets/slotBar/scripts/services/ApiService.ts"],"names":["ApiService","ServiceBase","register","username","password","email","response","fetch","API_BASE","method","headers","body","JSON","stringify","ok","errorData","json","catch","message","status","success","error","login","console","log","data","token","getMe","Error"],"mappings":"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","sourcesContent":["// assets/scripts/services/ApiService.ts\r\nimport {ServiceBase} from \"db://assets/slotBar/scripts/services/ServiceBase\";\r\n\r\nexport class ApiService {\r\n    // 註冊\r\n    static async register(username: string, password: string, email: string): Promise<{\r\n        success: boolean;\r\n        message?: string\r\n    }> {\r\n        try {\r\n            const response = await fetch(`${ServiceBase.API_BASE}/register`, {\r\n                method: 'POST',\r\n                headers: {'Content-Type': 'application/json'},\r\n                body: JSON.stringify({username, password, email})\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json().catch(() => null); // 解析失敗也不會爆\r\n                const message = errorData?.message || `註冊失敗：${response.status}`;\r\n                return {success: false, message};\r\n            }\r\n\r\n            return {success: true};\r\n        } catch (error: any) {\r\n            return {success: false, message: error.message || '網路錯誤，請稍後再試'};\r\n        }\r\n    }\r\n\r\n    // 登入並儲存 token\r\n    static async login(username: string, password: string): Promise<{ success: boolean; message?: string }> {\r\n        try {\r\n            const response = await fetch(`${ServiceBase.API_BASE}/login`, {\r\n                method: 'POST',\r\n                headers: {'Content-Type': 'application/json'},\r\n                body: JSON.stringify({username, password})\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json().catch(() => null); // 解析失敗也不會爆\r\n                const message = errorData?.message || `登入失敗：${response.status}`;\r\n                return {success: false, message};\r\n            }\r\n            const json = await response.json();\r\n            console.log(\"取得token成功：\", json.data.token);\r\n            ServiceBase.token = json.data.token;\r\n            return {success: true};\r\n        } catch (error: any) {\r\n            return {success: false, message: error.message || '網路錯誤，請稍後再試'};\r\n        }\r\n    }\r\n\r\n    // 拿目前登入的使用者資訊\r\n    static async getMe(): Promise<any> {\r\n        if (!ServiceBase.token) throw new Error(\"尚未登入\");\r\n\r\n        const response = await fetch(`${ServiceBase.API_BASE}/me`, {\r\n            headers: {'Authorization': `Bearer ${ServiceBase.token}`}\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`取得使用者資訊失敗：${response.status}`);\r\n        }\r\n\r\n        return await response.json();\r\n    }\r\n}"]}