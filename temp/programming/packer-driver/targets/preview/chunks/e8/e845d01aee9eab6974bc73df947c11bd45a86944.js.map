{"version":3,"sources":["file:///D:/Desktop/cocosProject/SlotBar/assets/slotBar/scripts/views/ReelView.ts"],"names":["_decorator","Button","Component","RichText","slotBarEventBus","soltEventTypes","ReelSlots","ReelSlot","ccclass","property","ReelView","spinCompletedCount","onEnable","startButton","node","on","onClickSpin","InitReel","onInitReel","FetchResult","onFetchResult","onDisable","off","symbolDataList","i","reelViews","length","initReel","results","active","reelView","getComponent","spinRounds","console","log","onOneSpinEnd","showFinalResult","emit","AllReelsFinished","spinToSymbol","resultRichText","string","SpinStart","join"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, RichText } from 'cc';\r\nimport slotBarEventBus from '../eventSystem/EventCenter';\r\nimport { soltEventTypes } from '../eventSystem/EventTypes';\r\nimport { SymbolData } from '../types/SymbolData';\r\nimport { ReelSlot as ReelSlots } from '../views/ReelSlot';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ReelView')\r\nexport class ReelView extends Component {\r\n\r\n    @property(ReelSlots)\r\n    reelViews: ReelSlots[] = [];\r\n\r\n    @property(Button)\r\n    startButton: Button = null;\r\n\r\n    @property(RichText)\r\n    resultRichText: RichText = null;\r\n\r\n    private spinCompletedCount = 0; // Áî®‰æÜË®òÈåÑÂÆåÊàêÂπæÂÄãÊªæËº™\r\n\r\n    onEnable() {\r\n        this.startButton.node.on('click', this.onClickSpin, this);\r\n        slotBarEventBus.on(soltEventTypes.InitReel, this.onInitReel, this);\r\n        slotBarEventBus.on(soltEventTypes.FetchResult, this.onFetchResult, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.startButton.node.off('click', this.onClickSpin, this);\r\n        slotBarEventBus.off(soltEventTypes.InitReel, this.onInitReel, this);\r\n        slotBarEventBus.off(soltEventTypes.FetchResult, this.onFetchResult, this);\r\n    }\r\n\r\n    private onInitReel(symbolDataList: SymbolData[]) {\r\n        for (let i = 0; i < this.reelViews.length; i++) {\r\n            this.reelViews[i].initReel(symbolDataList);\r\n        }\r\n    }\r\n\r\n    private onFetchResult(results: string[]) {\r\n        this.startButton.node.active = false; // ÈáçÊñ∞ÂïüÁî®ÈñãÂßãÊåâÈàï\r\n        for (let i = 0; i < this.reelViews.length; i++) {\r\n            const reelView = this.reelViews[i].getComponent(ReelSlots);\r\n            if (reelView) {\r\n                const spinRounds = 3 + i; // Á¨¨‰∏ÄËº™ËΩâ 3 ÂúàÔºåÁ¨¨‰∫åËº™ËΩâ 4 ÂúàÔºåÁ¨¨‰∏âËº™ËΩâ 5 Âúà\r\n                console.log(`Ê®°Êì¨ÁµêÊûú: ${results[i]}`);\r\n                const onOneSpinEnd = () => {\r\n                    this.spinCompletedCount++;\r\n                    if (this.spinCompletedCount === this.reelViews.length) {\r\n                        this.showFinalResult(results);\r\n                        this.startButton.node.active = true; // ÈáçÊñ∞ÂïüÁî®ÈñãÂßãÊåâÈàï\r\n                        slotBarEventBus.emit(soltEventTypes.AllReelsFinished);\r\n                    }\r\n                };\r\n\r\n                reelView.spinToSymbol(results[i], spinRounds, 0.5, onOneSpinEnd);\r\n            }\r\n        }\r\n    }\r\n\r\n    onClickSpin() {\r\n        this.spinCompletedCount = 0; // ÈáçÁΩÆÂÆåÊàêË®àÊï∏\r\n        this.resultRichText.string = 'üé∞ ÊóãËΩâ‰∏≠...';\r\n        slotBarEventBus.emit(soltEventTypes.SpinStart);\r\n    }\r\n\r\n    showFinalResult(results: string[]) {\r\n        this.resultRichText.string = `üéâ ÁµêÊûúÔºö${results.join(' - ')}`;\r\n    }\r\n}\r\n\r\n\r\n"]}